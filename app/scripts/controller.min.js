var app=null;!function(){"use strict";app=angular.module("ajsApp",["common.services","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"])}(),function(){"use strict";angular.module("ajsApp").factory("AuthenticationService",["Auth","Base64","$http","$cookieStore","$rootScope","$timeout",function(a,b,c,d,e,f){var g={};return e.displayLogout=!1,g.Login=function(b,c){var d={nick:b};a.Login(d).$promise.then(function(a){c(a)}).catch(function(a){c(a)})},g.SetCredentials=function(a){var c=b.encode(a.Nick);e.globals={currentUser:{nick:a.Nick,authdata:c}},localStorage.setItem("usrData",JSON.stringify(a)),d.put("globals",e.globals)},g.ClearCredentials=function(){localStorage.removeItem("usrData"),e.globals={},d.remove("globals"),c.defaults.headers.common.Authorization="Basic "},g}]).factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}})}(),function(){"use strict";angular.module("common.services",["ngResource"]).constant("appSettings",{serverPath:"https://frontpage-jdaza13.c9users.io"})}(),function(){"use strict";var a=angular.module("common.services").factory("appSettings",["ngResource","ngRoute","$http"]);a.factory("Auth",function(a,b){return a(null,{},{Login:{method:"POST",url:b.serverPath+"/api/Auth/Login"},RecuperarUsuario:{method:"POST",url:b.serverPath+"/api/Auth/RecoverNick"}})}),a.factory("Users",function(a,b){return a(null,{},{ObtenerUsuarios:{method:"GET",url:b.serverPath+"/api/Users/GetAllUsers"},CrearEditarUsuario:{method:"POST",url:b.serverPath+"/api/Users/CreateEditUser"}})}),a.factory("GEO",function(a,b){return a(null,{},{GetGEOLocation:{method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?latlng=:lat,:long&sensor=true"}})})}(),function(){function a(a,b,c,d,e,f){b.pathToBackground="/images/ubuntu1.jpg",b.usrLogged=!1;var g=c.globals.currentUser;JSON.parse(localStorage.getItem("usrData"));g?(b.loggedUserInfo="Hola, "+g.nick,b.usrLogged=!0):(b.loggedUserInfo="Iniciar sesi贸n",b.usrLogged=!1,$("#userInfo").addClass("likeAnchor"),$("#userInfo").click(function(){$("#modalLogin").modal("show")})),b.goFullScreen=function(){screenfull.enabled&&screenfull.toggle()},b.Logout=function(){f.ClearCredentials(),location.reload("#/login")}}app.controller("desktopController",a);a.$inject=["Users","$scope","$rootScope","$location","$routeParams","AuthenticationService"]}(),function(){function a(a,b,c,d,e,f){var g=new Ventus.WindowManager;b.gchatWindow=void 0;var h=$(window).width(),i=$(window).height(),j=io.connect();b.usrData=JSON.parse(localStorage.getItem("usrData")),b.messages=[],b.blurMsgs=[],b.inputMsg="",b.contacts=[],a.ObtenerUsuarios().$promise.then(function(a){b.contacts=a.Users}).catch(function(a){console.log(a)}),b.openUserInfoModal=function(){$("#modalUserInfo").modal("show")},b.closeModalUserInfo=function(){$("#modalUserInfo").modal("hide")},b.openAboutModal=function(){$("#modalAbout").modal("show")},b.closeModalAbout=function(){$("#modalAbout").modal("hide")},b.openGChatWindow=function(){b.gchatWindow.open()},b.defineChatWindow=function(){$("#globalChat").removeClass("displayNone"),b.gchatWindow=g.createWindow.fromQuery("#globalChat",{title:"Sala General",classname:"globalChatWindow",width:2*(h/3),height:5*(i/6),x:h/6,y:i/8,resizable:!1,events:{open:function(){setTimeout(function(){$(".chatMsgs").animate({scrollTop:$(".chatMsgs").prop("scrollHeight")},500),$(".chatInput").focus()},500)}}}),$("#globalChat").css("width",2*(h/3)),$("#globalChat").css("height",5*(i/6))},b.SendMsg=function(){var a=b.usrData.Nombre,c=moment().format("DD/MM/YYYY HH:mm"),d=this.inputMsg,e={Sender:a,Msg:d,Date:c};""!=this.inputMsg&&(j.emit("broadcast",e),this.inputMsg="")},j.on("serverSays",function(a){b.messages.push(a),b.$apply(),$(".chatMsgs").scrollTop($(".chatMsgs")[0].scrollHeight)}),e.onfocus=function(){},e.onblur=function(){}}app.controller("homeController",a);a.$inject=["Users","$scope","$rootScope","$location","$window","$routeParams"]}(),function(){function a(a,b,c,d,e,f,g,h){$("#modalLogin").modal("show"),d.Nickname="",d.RegData={_id:null,Address:"Calculando...",Photo:"images/empty_photo_150.png"},d.GEOInfo={},d.EmailRecover="",d.Login=function(a){h.Login(d.Nickname,function(a){a.success?(h.SetCredentials(a.success),toastr.success("Autenticaci贸n satisfactoria!"),$("#modalLogin").modal("hide"),setTimeout(function(){location.reload("#/home")},500)):toastr.error(a.Msg)})},d.openRegisterModal=function(){$("#modalLogin").modal("hide"),$("#modalRegister").modal("show"),d.getGEOInfo()},d.openRecoverModal=function(){$("#modalLogin").modal("hide"),$("#modalRecover").modal("show")},d.Register=function(a){var c={User:d.RegData};b.CrearEditarUsuario(c).$promise.then(function(a){toastr.success("Registro satisfactorio"),setTimeout(function(){location.reload()},500)}).catch(function(a){console.log(a)})},d.Recover=function(b){var c={User:{Email:d.EmailRecover}};a.RecuperarUsuario(c).$promise.then(function(a){"success"==a.status?(toastr.success(a.Msg),setTimeout(function(){location.reload()},500)):toastr.error(a.Msg)}).catch(function(a){console.log(a)})},d.choosePhoto=function(){$("#photoRegSelect").trigger("click")},d.getGEOInfo=function(){navigator.geolocation.getCurrentPosition(function(a){d.GEOInfo.coords=a.coords;var b=d.GEOInfo.coords;c.GetGEOLocation({lat:b.latitude,long:b.longitude}).$promise.then(function(a){a.results.length>0?d.RegData.Address=a.results[0].formatted_address:(d.RegData.Address="",toastr.error("Error al obtener la direcci贸n"))}).catch(function(a){toastr.error("Error al obtener la direcci贸n")})})},d.photoRegSelected=function(){var a=document.getElementById("photoRegSelect").files[0],b=document.createElement("img"),c=new FileReader;c.onload=function(a){b.src=a.target.result;var c=document.createElement("canvas"),e=150,f=150,g=b.width,h=b.height;g>h?g>e&&(h*=e/g,g=e):h>f&&(g*=f/h,h=f),c.width=g,c.height=h;var i=c.getContext("2d");i.drawImage(b,0,0,g,h);var j=c.toDataURL("image/png");d.RegData.Photo=j,d.$apply()},c.readAsDataURL(a)}}app.controller("loginController",a);a.$inject=["Auth","Users","GEO","$scope","$rootScope","$location","$routeParams","AuthenticationService"]}(),function(){function a(a,b,c,d){alert("Hola mundo!")}app.controller("registerController",a);a.$inject=["$scope","$rootScope","$location","$routeParams"]}(),function(){function a(a,b,c,d,e,f){b.usrData=JSON.parse(localStorage.getItem("usrData")),$("#modalUserInfo").modal("show")}app.controller("userInfoController",a);a.$inject=["Users","$scope","$rootScope","$location","$routeParams","AuthenticationService"]}(),function(){app.config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"homeController",controllerAs:"vm",caseInsensitiveMatch:!0}),a.when("/login",{templateUrl:"views/login.html",controller:"loginController",controllerAs:"vm",caseInsensitiveMatch:!0}),a.when("/register",{templateUrl:"views/register.html",controller:"registerController",controllerAs:"vm",caseInsensitiveMatch:!0}),a.otherwise({redirectTo:"/home"})}]),app.run(["$rootScope","$location","$cookieStore","$templateCache",function(a,b,c,d){a.globals=c.get("globals")||{},a.globals.currentUser,a.$on("$locationChangeStart",function(c,d,e){a.globals.currentUser&&"/login"==b.path()&&b.path("/home"),"/login"===b.path()||a.globals.currentUser||b.path("/login")})}])}();